<UserControl x:Class="SYNKROAPP.Vistes.Vista_Mercado.VistaEmpresas.PantallaEmpresasEnElMercadoWPF"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SYNKROAPP.Vistes.Vista_Mercado.VistaEmpresas"
             mc:Ignorable="d" 
             d:DesignHeight="832" d:DesignWidth="1280">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Encabezado -->
            <RowDefinition Height="*"/>
            <!-- Contenido principal -->
        </Grid.RowDefinitions>

        <!-- Encabezado con gradiente -->
        <Border Grid.Row="0" Padding="40,30,40,30">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#2563eb" Offset="0"/>
                    <GradientStop Color="#3b82f6" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <StackPanel Grid.Column="0">
                <TextBlock FontSize="32" FontWeight="Bold" Foreground="White" Text="CATÁLOGO DE EMPRESAS"/>
                <TextBlock Text="Explore empresas con productos disponibles en el mercado" 
                           FontSize="18" Foreground="#e0f2fe" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- Contenido: búsqueda, filtro y catálogo -->
        <Grid Grid.Row="1" Margin="40,25,40,25">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Barra de búsqueda y filtros -->
                <RowDefinition Height="*"/>
                <!-- Catálogo -->
            </Grid.RowDefinitions>
            
            <!-- Barra de búsqueda y filtros -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" x:Name="txtBusqueda" 
                       Margin="0,0,15,0" Text="{Binding TextoBusqueda, UpdateSourceTrigger=PropertyChanged}"/>

                <!--<ComboBox Grid.Column="1" x:Name="cmbSector" Width="180" Margin="0,0,15,0" 
                        ItemsSource="{Binding SectoresDisponibles}" 
                        SelectedItem="{Binding SectorSeleccionado, UpdateSourceTrigger=PropertyChanged}"
                        DisplayMemberPath="Nombre" 
                       />-->

                <Button Grid.Column="2" x:Name="btnUbicacion" Width="180" Margin="0,0,15,0" Height="40"
                        Click="btnUbicacion_Click">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE707;" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" 
                                 Margin="0,0,8,0" Foreground="#6b7280"/>
                        <TextBlock Text="{Binding UbicacionTexto, FallbackValue='Ubicación'}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Popup para el selector de rango de ubicación -->
                <Popup x:Name="popupUbicacion" 
                     PlacementTarget="{Binding ElementName=btnUbicacion}" StaysOpen="False">
                    <Border Background="White" BorderBrush="#e5e7eb" BorderThickness="1" 
                            CornerRadius="6" Width="200">
                        
                        <Border.Effect>
                            <DropShadowEffect Color="#1e293b" BlurRadius="15" Opacity="0.1" ShadowDepth="2"/>
                        </Border.Effect>

                        <StackPanel Margin="15">
                            <TextBlock Text="Seleccionar rango de distancia" FontWeight="SemiBold" 
                                     Foreground="#1f2937" Margin="0,0,0,12"/>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <TextBlock Text="{Binding ValorSliderUbicacion, StringFormat={}{0} km}" 
                                         FontWeight="Medium" Foreground="#2563eb"/>
                                <TextBlock Text=" a la redonda" Foreground="#4b5563"/>
                            </StackPanel>

                            <Slider x:Name="sliderUbicacion" Minimum="1" Maximum="100" 
                                  Value="{Binding ValorSliderUbicacion, Mode=TwoWay}" 
                                  IsSnapToTickEnabled="True" TickFrequency="1" 
                                  Margin="0,0,0,15"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0" Content="Cancelar" Style="{StaticResource SecondaryButton}" 
                                      Margin="0,0,5,0" Name="btnCancelarUbicacion"  Click="btnCancelarUbicacion_Click"/>

                                <Button Grid.Column="1" Name="btnAplicarUbicacion" Content="Aplicar" Style="{StaticResource PrimaryButton}" 
                                      Margin="5,0,0,0" Click="btnAplicarUbicacion_Click"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Popup>
            </Grid>
            
            <!-- Catálogo de empresas -->
            <Border Grid.Row="1" Background="White" CornerRadius="12">
                <Border.Effect>
                    <DropShadowEffect Color="#1e293b" BlurRadius="15" Opacity="0.1" ShadowDepth="2"/>
                </Border.Effect>
                
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Título del catálogo -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="#3b82f6" Width="4" Height="24" CornerRadius="2" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="EMPRESAS DISPONIBLES" FontWeight="Bold" FontSize="18" Foreground="#1e3a8a"/>
                        </StackPanel>

                        <TextBlock Grid.Column="1" Text="{Binding TextoResultados}" Foreground="#6b7280" 
                                 VerticalAlignment="Center" FontSize="14"/>
                    </Grid>
                    
                    <!-- Grid con las tarjetas -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="icEmpresas" ItemsSource="{Binding EmpresasFiltradas}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Margin="8" 
                                            Command="{Binding DataContext.VerProductosCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" 
                                            CommandParameter="{Binding}">
                                        
                                        <Border Width="280" Height="340" CornerRadius="10" Background="White" 
                                                BorderBrush="#e5e7eb" BorderThickness="1">
                                            <Border.Effect>
                                                <DropShadowEffect Color="#64748b" BlurRadius="15" Opacity="0.1" ShadowDepth="2"/>
                                            </Border.Effect>
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="140"/>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <!-- Banner superior con logo -->
                                                <Border Grid.Row="0" Background="Pink" CornerRadius="10,10,0,0">
                                                    <Grid>
                                                        <Border Width="80" Height="80" Background="White" CornerRadius="40"
                                                                HorizontalAlignment="Center" VerticalAlignment="Center" ClipToBounds="True">
                                                            <Viewbox Stretch="UniformToFill">
                                                                <Image Source="{Binding FotoEmpresalUrl}"
                                                                       Width="80" Height="80"
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"/>
                                                            </Viewbox>
                                                        </Border>
                                                    </Grid>
                                                </Border>



                                                <!-- Información de la empresa -->
                                                <StackPanel Grid.Row="1" Margin="16,16,16,10">
                                                    <TextBlock Text="{Binding NomEmpresa}" FontWeight="Bold" FontSize="18" 
                                                               Foreground="#0f172a" TextWrapping="Wrap" TextAlignment="Center"/>

                                                    <Grid Margin="0,12,0,0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="Sector:" FontWeight="Medium" 
                                                                   Foreground="#64748b" Margin="0,0,5,0"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding Tipus}" FontWeight="Medium" 
                                                                   Foreground="#334155" TextWrapping="Wrap"/>
                                                    </Grid>

                                                    <Grid Margin="0,6,0,0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="Ubicación:" FontWeight="Medium" 
                                                                   Foreground="#64748b" Margin="0,0,5,0"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding Ubicacio}" FontWeight="Medium" 
                                                                   Foreground="#334155" TextWrapping="Wrap"/>
                                                    </Grid>

                                                </StackPanel>

                                                <!-- Botones (puedes conservar este si lo deseas adicional) -->
                                                <Grid Grid.Row="2" Margin="16,0,16,16">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0" Text="Ver Productos" FontSize="14" Foreground="#2563eb" 
                                                               VerticalAlignment="Center" HorizontalAlignment="Left" />
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </Button>

                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
                
            </Border>
        </Grid>
       
    </Grid>
    
</UserControl>
